---
title: 机器学习和chatGPT
author: Package Build
date: '2024-05-29'
slug: chatgpt
categories:
  - 机器学习
tags:
  - mlr3
---



<p>最近一年发生的事情实在是太多了，chatGPT改变了我们学习的方式。再去做一个知识存储器，已经变得毫无意义。从另外一个角度看，我们已经不需要去记忆。chatGPT就是我们的第二大脑。我们要做的是，如何利用chatGPT来实现自己的想法。创造性、批判性思维是未来衡量一个人是否优秀的重要标准。</p>
<p>看看如何用chatGPT来构建一个机器学习的代码，实现对性别的预测。</p>
<pre class="r"><code>rm(list=ls())
# 安装和加载必要的包
library(mlr3)
library(mlr3learners)
library(mlr3filters)
library(mlr3tuning)</code></pre>
<pre><code>## Loading required package: paradox</code></pre>
<pre class="r"><code>library(data.table)
library(mlr3verse)
library(mlr3viz)

# 读取包括SNP和性别信息的训练文件
sex_snp_dt &lt;- fread(file=&quot;../datasets/BP_55K_SNP_Sex.csv&quot;, sep=&quot;,&quot;,header = TRUE) 


# 创建任务
sex_task &lt;- as_task_classif(sex_snp_dt, target = &quot;Sex&quot;,id=&quot;PreSex&quot;)

# 去除ID列
features_to_keep &lt;- setdiff(sex_task$feature_names, &quot;ID&quot;)

# Select only the desired features
sex_task$select(features_to_keep)

# 创建随机森林学习器，基于Gini指数的减少来衡量变量的重要性
rf_learner &lt;- lrn(&quot;classif.ranger&quot;, predict_type= &quot;prob&quot;, importance = &quot;impurity&quot;, keep.inbag = TRUE, num.trees=100, write.forest = TRUE)

# 查看学习器的参数
rf_learner$param_set</code></pre>
<pre><code>## &lt;ParamSet(28)&gt;
## Key: &lt;id&gt;
##                               id    class lower upper nlevels        default
##                           &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;   &lt;num&gt;         &lt;list&gt;
##  1:       always.split.variables ParamUty    NA    NA     Inf &lt;NoDefault[0]&gt;
##  2:                class.weights ParamUty    NA    NA     Inf         [NULL]
##  3:                      holdout ParamLgl    NA    NA       2          FALSE
##  4:                   importance ParamFct    NA    NA       4 &lt;NoDefault[0]&gt;
##  5:                   keep.inbag ParamLgl    NA    NA       2          FALSE
##  6:                    max.depth ParamInt     1   Inf     Inf         [NULL]
##  7:                   min.bucket ParamUty    NA    NA     Inf              1
##  8:                min.node.size ParamUty    NA    NA     Inf         [NULL]
##  9:                         mtry ParamInt     1   Inf     Inf &lt;NoDefault[0]&gt;
## 10:                   mtry.ratio ParamDbl     0     1     Inf &lt;NoDefault[0]&gt;
## 11:                    na.action ParamFct    NA    NA       3       na.learn
## 12:                   node.stats ParamLgl    NA    NA       2          FALSE
## 13:            num.random.splits ParamInt     1   Inf     Inf              1
## 14:                  num.threads ParamInt     1   Inf     Inf              1
## 15:                    num.trees ParamInt     1   Inf     Inf            500
## 16:                    oob.error ParamLgl    NA    NA       2           TRUE
## 17:        regularization.factor ParamUty    NA    NA     Inf              1
## 18:      regularization.usedepth ParamLgl    NA    NA       2          FALSE
## 19:                      replace ParamLgl    NA    NA       2           TRUE
## 20:    respect.unordered.factors ParamFct    NA    NA       3 &lt;NoDefault[0]&gt;
## 21:              sample.fraction ParamDbl     0     1     Inf &lt;NoDefault[0]&gt;
## 22:                  save.memory ParamLgl    NA    NA       2          FALSE
## 23: scale.permutation.importance ParamLgl    NA    NA       2          FALSE
## 24:                         seed ParamInt  -Inf   Inf     Inf         [NULL]
## 25:         split.select.weights ParamUty    NA    NA     Inf         [NULL]
## 26:                    splitrule ParamFct    NA    NA       3           gini
## 27:                      verbose ParamLgl    NA    NA       2           TRUE
## 28:                 write.forest ParamLgl    NA    NA       2           TRUE
##                               id    class lower upper nlevels        default
##        parents    value
##         &lt;list&gt;   &lt;list&gt;
##  1:     [NULL]   [NULL]
##  2:     [NULL]   [NULL]
##  3:     [NULL]   [NULL]
##  4:     [NULL] impurity
##  5:     [NULL]     TRUE
##  6:     [NULL]   [NULL]
##  7:     [NULL]   [NULL]
##  8:     [NULL]   [NULL]
##  9:     [NULL]   [NULL]
## 10:     [NULL]   [NULL]
## 11:     [NULL]   [NULL]
## 12:     [NULL]   [NULL]
## 13:  splitrule   [NULL]
## 14:     [NULL]        1
## 15:     [NULL]      100
## 16:     [NULL]   [NULL]
## 17:     [NULL]   [NULL]
## 18:     [NULL]   [NULL]
## 19:     [NULL]   [NULL]
## 20:     [NULL]   [NULL]
## 21:     [NULL]   [NULL]
## 22:     [NULL]   [NULL]
## 23: importance   [NULL]
## 24:     [NULL]   [NULL]
## 25:     [NULL]   [NULL]
## 26:     [NULL]   [NULL]
## 27:     [NULL]   [NULL]
## 28:     [NULL]     TRUE
##        parents    value</code></pre>
<pre class="r"><code># 创建交叉验证
resampling &lt;- rsmp(&quot;cv&quot;, folds = 5)

# 进行交叉验证
resample_result &lt;- resample(sex_task, rf_learner, resampling, store_models = TRUE)</code></pre>
<pre><code>## INFO  [18:52:45.582] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:45.940] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:45.976] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:46.002] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:46.029] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)</code></pre>
<pre class="r"><code># 设置评估参考群数据的预测能力的度量标准
# 准确性
measure_acc &lt;- msr(&quot;classif.acc&quot;)
# 工作特征曲线下面积
measure_auc &lt;- msr(&quot;classif.auc&quot;)

# 打印交叉验证结果
resample_result$aggregate(measure_acc)</code></pre>
<pre><code>## classif.acc 
##   0.9806452</code></pre>
<pre class="r"><code>resample_result$aggregate(measure_auc)</code></pre>
<pre><code>## classif.auc 
##   0.9893049</code></pre>
<pre class="r"><code>autoplot(resample_result,type = &quot;roc&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code># 定义超参数搜索空间
#	1.	mtry：每个树分割节点随机选择的变量数量。
#	•	p_int(1, ncol(data) - 1)：mtry的取值范围是从1到数据集中变量数量减1。
#	2.	min.node.size：树叶节点的最小样本数。
#	•	p_int(1, 10)：min.node.size的取值范围是1到10。
search_space &lt;- ps(
  mtry = p_int(1, length(sex_task$feature_names) - 1),
  min.node.size = p_int(1, 10)
)

# 定义调优实例
tuner &lt;- tnr(&quot;grid_search&quot;, resolution = 10)
instance &lt;- ti(
  task = sex_task,
  learner = rf_learner,
  resampling = resampling,
  measure = measure_acc,
  search_space = search_space,
  terminator = trm(&quot;evals&quot;, n_evals = 20)
)


# 进行超参数调优
tuner$optimize(instance)</code></pre>
<pre><code>## INFO  [18:52:46.395] [bbotk] Starting to optimize 2 parameter(s) with &#39;&lt;OptimizerBatchGridSearch&gt;&#39; and &#39;&lt;TerminatorEvals&gt; [n_evals=20, k=0]&#39;
## INFO  [18:52:46.410] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:46.413] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:46.418] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:46.468] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:46.515] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:46.563] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:46.607] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:46.648] [mlr3] Finished benchmark
## INFO  [18:52:46.663] [bbotk] Result of batch 1:
## INFO  [18:52:46.664] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:46.664] [bbotk]    21             3   0.9733871        0      0            0.205
## INFO  [18:52:46.664] [bbotk]                                 uhash
## INFO  [18:52:46.664] [bbotk]  c051b256-89e3-4256-a6ce-1689054ae6ce
## INFO  [18:52:46.666] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:46.668] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:46.673] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:46.714] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:46.757] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:46.796] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:46.834] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:46.871] [mlr3] Finished benchmark
## INFO  [18:52:46.884] [bbotk] Result of batch 2:
## INFO  [18:52:46.886] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:46.886] [bbotk]    16             8   0.9798387        0      0            0.177
## INFO  [18:52:46.886] [bbotk]                                 uhash
## INFO  [18:52:46.886] [bbotk]  fa478f45-1bc9-483a-8ed3-c10b96e86e45
## INFO  [18:52:46.887] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:46.890] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:46.895] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:46.932] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:46.966] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:47.006] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:47.041] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:47.074] [mlr3] Finished benchmark
## INFO  [18:52:47.087] [bbotk] Result of batch 3:
## INFO  [18:52:47.089] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:47.089] [bbotk]    11             7   0.9806452        0      0            0.154
## INFO  [18:52:47.089] [bbotk]                                 uhash
## INFO  [18:52:47.089] [bbotk]  ec5a4a63-d89b-4ba2-9a57-195d577e7013
## INFO  [18:52:47.090] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:47.092] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:47.097] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:47.136] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:47.173] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:47.214] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:47.251] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:47.286] [mlr3] Finished benchmark
## INFO  [18:52:47.299] [bbotk] Result of batch 4:
## INFO  [18:52:47.300] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:47.300] [bbotk]    13             4   0.9798387        0      0            0.163
## INFO  [18:52:47.300] [bbotk]                                 uhash
## INFO  [18:52:47.300] [bbotk]  2559466a-ce4e-47e3-a7b8-636e6c3ac611
## INFO  [18:52:47.301] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:47.304] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:47.308] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:47.357] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:47.403] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:47.450] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:47.499] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:47.542] [mlr3] Finished benchmark
## INFO  [18:52:47.555] [bbotk] Result of batch 5:
## INFO  [18:52:47.556] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:47.556] [bbotk]    23             5   0.9782258        0      0            0.212
## INFO  [18:52:47.556] [bbotk]                                 uhash
## INFO  [18:52:47.556] [bbotk]  64ddcd9e-ad43-4cce-9d19-2a3a1517ac59
## INFO  [18:52:47.557] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:47.560] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:47.564] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:47.598] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:47.630] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:47.661] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:47.692] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:47.725] [mlr3] Finished benchmark
## INFO  [18:52:47.738] [bbotk] Result of batch 6:
## INFO  [18:52:47.739] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:47.739] [bbotk]     8             8   0.9806452        0      0            0.137
## INFO  [18:52:47.739] [bbotk]                                 uhash
## INFO  [18:52:47.739] [bbotk]  6d37bad2-ba1c-4b55-aea8-55171c93652e
## INFO  [18:52:47.741] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:47.743] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:47.747] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:47.781] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:47.813] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:47.846] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:47.878] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:47.910] [mlr3] Finished benchmark
## INFO  [18:52:47.923] [bbotk] Result of batch 7:
## INFO  [18:52:47.925] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:47.925] [bbotk]     8             5   0.9806452        0      0            0.136
## INFO  [18:52:47.925] [bbotk]                                 uhash
## INFO  [18:52:47.925] [bbotk]  0884e1c8-62c7-45c7-b5aa-8e5ce9f1ffc8
## INFO  [18:52:47.926] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:47.928] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:47.933] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:47.958] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:47.983] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:48.008] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:48.033] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:48.060] [mlr3] Finished benchmark
## INFO  [18:52:48.073] [bbotk] Result of batch 8:
## INFO  [18:52:48.074] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:48.074] [bbotk]     3             2   0.9806452        0      0            0.106
## INFO  [18:52:48.074] [bbotk]                                 uhash
## INFO  [18:52:48.074] [bbotk]  720f10c9-b6cc-4064-af13-f10d471ad670
## INFO  [18:52:48.075] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:48.078] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:48.082] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:48.107] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:48.134] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:48.161] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:48.187] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:48.215] [mlr3] Finished benchmark
## INFO  [18:52:48.229] [bbotk] Result of batch 9:
## INFO  [18:52:48.231] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:48.231] [bbotk]     3            10   0.9806452        0      0            0.106
## INFO  [18:52:48.231] [bbotk]                                 uhash
## INFO  [18:52:48.231] [bbotk]  eda90fb4-22e0-4c68-9d75-55ce278cfa67
## INFO  [18:52:48.232] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:48.235] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:48.240] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:48.272] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:48.304] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:48.336] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:48.496] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:48.526] [mlr3] Finished benchmark
## INFO  [18:52:48.540] [bbotk] Result of batch 10:
## INFO  [18:52:48.541] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:48.541] [bbotk]     6             5   0.9806452        0      0            0.264
## INFO  [18:52:48.541] [bbotk]                                 uhash
## INFO  [18:52:48.541] [bbotk]  eb0b2e02-6bb6-4cdd-8767-8cf2ca2909ae
## INFO  [18:52:48.542] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:48.545] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:48.550] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:48.577] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:48.604] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:48.630] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:48.656] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:48.681] [mlr3] Finished benchmark
## INFO  [18:52:48.696] [bbotk] Result of batch 11:
## INFO  [18:52:48.697] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:48.697] [bbotk]     3             1   0.9806452        0      0            0.106
## INFO  [18:52:48.697] [bbotk]                                 uhash
## INFO  [18:52:48.697] [bbotk]  9621279c-b23c-4bba-a111-5b81c3c5f5f5
## INFO  [18:52:48.698] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:48.702] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:48.707] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:48.747] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:48.786] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:48.849] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:48.892] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:48.928] [mlr3] Finished benchmark
## INFO  [18:52:48.942] [bbotk] Result of batch 12:
## INFO  [18:52:48.943] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:48.943] [bbotk]    13             9   0.9814516        0      0            0.186
## INFO  [18:52:48.943] [bbotk]                                 uhash
## INFO  [18:52:48.943] [bbotk]  084e851c-1159-44ab-abaf-d57fdeba5905
## INFO  [18:52:48.945] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:48.947] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:48.952] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:49.002] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:49.050] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:49.094] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:49.138] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:49.180] [mlr3] Finished benchmark
## INFO  [18:52:49.195] [bbotk] Result of batch 13:
## INFO  [18:52:49.196] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:49.196] [bbotk]    21             6   0.9790323        0      0            0.204
## INFO  [18:52:49.196] [bbotk]                                 uhash
## INFO  [18:52:49.196] [bbotk]  a7c2a9d0-dc35-47f7-b9ed-ab1c80c387e1
## INFO  [18:52:49.197] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:49.201] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:49.205] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:49.249] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:49.295] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:49.338] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:49.377] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:49.414] [mlr3] Finished benchmark
## INFO  [18:52:49.427] [bbotk] Result of batch 14:
## INFO  [18:52:49.428] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:49.428] [bbotk]    16             3   0.9782258        0      0            0.182
## INFO  [18:52:49.428] [bbotk]                                 uhash
## INFO  [18:52:49.428] [bbotk]  d0b6c50e-1a48-4334-9a5c-4bccb03448d3
## INFO  [18:52:49.430] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:49.432] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:49.437] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:49.463] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:49.488] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:49.514] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:49.538] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:49.562] [mlr3] Finished benchmark
## INFO  [18:52:49.579] [bbotk] Result of batch 15:
## INFO  [18:52:49.580] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:49.580] [bbotk]     3             4   0.9806452        0      0            0.104
## INFO  [18:52:49.580] [bbotk]                                 uhash
## INFO  [18:52:49.580] [bbotk]  2a9d4a90-59c5-4318-9e98-8361e15fa3c7
## INFO  [18:52:49.581] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:49.584] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:49.588] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:49.633] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:49.676] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:49.722] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:49.766] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:49.808] [mlr3] Finished benchmark
## INFO  [18:52:49.823] [bbotk] Result of batch 16:
## INFO  [18:52:49.824] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:49.824] [bbotk]    18             2   0.9790323        0      0            0.194
## INFO  [18:52:49.824] [bbotk]                                 uhash
## INFO  [18:52:49.824] [bbotk]  c166d7c9-d987-446a-80d8-fb6b4ebb3a26
## INFO  [18:52:49.826] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:49.829] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:49.834] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:49.881] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:49.924] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:49.970] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:50.016] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:50.055] [mlr3] Finished benchmark
## INFO  [18:52:50.068] [bbotk] Result of batch 17:
## INFO  [18:52:50.069] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:50.069] [bbotk]    18             6   0.9790323        0      0            0.196
## INFO  [18:52:50.069] [bbotk]                                 uhash
## INFO  [18:52:50.069] [bbotk]  b4fcb094-3782-411c-9070-26a623412e70
## INFO  [18:52:50.070] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:50.073] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:50.077] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:50.114] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:50.148] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:50.183] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:50.218] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:50.253] [mlr3] Finished benchmark
## INFO  [18:52:50.268] [bbotk] Result of batch 18:
## INFO  [18:52:50.269] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:50.269] [bbotk]    11             9   0.9806452        0      0            0.153
## INFO  [18:52:50.269] [bbotk]                                 uhash
## INFO  [18:52:50.269] [bbotk]  4449e82b-c5be-46c7-9c33-239f446f3c4e
## INFO  [18:52:50.271] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:50.274] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:50.278] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:50.321] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:50.357] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:50.393] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:50.429] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:50.463] [mlr3] Finished benchmark
## INFO  [18:52:50.476] [bbotk] Result of batch 19:
## INFO  [18:52:50.477] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:50.477] [bbotk]    13             6   0.9790323        0      0            0.165
## INFO  [18:52:50.477] [bbotk]                                 uhash
## INFO  [18:52:50.477] [bbotk]  e15f1bd4-cd34-40ed-b718-0e109602edc2
## INFO  [18:52:50.478] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:52:50.481] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:52:50.485] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:52:50.505] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:52:50.525] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:52:50.546] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:52:50.571] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:52:50.592] [mlr3] Finished benchmark
## INFO  [18:52:50.606] [bbotk] Result of batch 20:
## INFO  [18:52:50.607] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:52:50.607] [bbotk]     1             7   0.9806452        0      0            0.083
## INFO  [18:52:50.607] [bbotk]                                 uhash
## INFO  [18:52:50.607] [bbotk]  16ebe019-be05-47f5-afa1-27d0c7ee8591
## INFO  [18:52:50.614] [bbotk] Finished optimizing after 20 evaluation(s)
## INFO  [18:52:50.614] [bbotk] Result:
## INFO  [18:52:50.615] [bbotk]   mtry min.node.size learner_param_vals  x_domain classif.acc
## INFO  [18:52:50.615] [bbotk]  &lt;int&gt;         &lt;int&gt;             &lt;list&gt;    &lt;list&gt;       &lt;num&gt;
## INFO  [18:52:50.615] [bbotk]     13             9          &lt;list[7]&gt; &lt;list[2]&gt;   0.9814516</code></pre>
<pre><code>##     mtry min.node.size learner_param_vals  x_domain classif.acc
##    &lt;int&gt;         &lt;int&gt;             &lt;list&gt;    &lt;list&gt;       &lt;num&gt;
## 1:    13             9          &lt;list[7]&gt; &lt;list[2]&gt;   0.9814516</code></pre>
<pre class="r"><code># 获取最佳参数
best_params &lt;- instance$result_learner_param_vals
print(best_params)</code></pre>
<pre><code>## $importance
## [1] &quot;impurity&quot;
## 
## $keep.inbag
## [1] TRUE
## 
## $num.threads
## [1] 1
## 
## $num.trees
## [1] 100
## 
## $write.forest
## [1] TRUE
## 
## $mtry
## [1] 13
## 
## $min.node.size
## [1] 9</code></pre>
<pre class="r"><code># 使用最佳参数训练模型
rf_learner$param_set$values &lt;- best_params
rf_learner$train(sex_task)

# 获取特征重要性
importance &lt;- as.data.table(rf_learner$importance(), keep.rownames = TRUE)
setnames(importance, c(&quot;Feature&quot;, &quot;Importance&quot;))

# 打印变量重要性
print(importance)</code></pre>
<pre><code>##                    Feature   Importance
##                     &lt;char&gt;        &lt;num&gt;
##  1:  NW_020869892.1_791056 291.55489896
##  2:   NW_020870605.1_27103 125.72003728
##  3:    NW_020871184.1_1572  56.64451534
##  4: NW_020870091.1_1375545  51.85042718
##  5:  NW_020872449.1_998527  28.99555194
##  6:   NW_020870770.1_64668  11.46137665
##  7:  NW_020868464.1_423800   5.40539002
##  8: NW_020872622.1_1032359   2.48794277
##  9:   NW_020869050.1_77499   2.48140552
## 10:  NW_020868494.1_348609   2.23608209
## 11:  NW_020870721.1_658002   1.35247580
## 12:   NW_020872396.1_14640   1.27892594
## 13:   NW_020870605.1_26371   1.16779698
## 14:  NW_020872535.1_937428   1.05669785
## 15:  NW_020871094.1_359648   0.95651083
## 16:  NW_020870605.1_296954   0.62636110
## 17:   NW_020870023.1_44774   0.60891028
## 18:   NW_020870770.1_46798   0.11390237
## 19:  NW_020869892.1_778639   0.10240764
## 20:  NW_020871839.1_399750   0.08292550
## 21:  NW_020869886.1_223326   0.02217173
## 22:  NW_020871839.1_399752   0.02043451
## 23:  NW_020870787.1_121276   0.02017241
## 24:   NW_020872461.1_91390   0.01559327
##                    Feature   Importance</code></pre>
<p>可视化随机森林的结果</p>
<pre class="r"><code>library(ggparty)</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Loading required package: partykit</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: libcoin</code></pre>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre class="r"><code># 获取随机森林模型中的所有树

autoplot(sex_task)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code># ROC curve for resample result
autoplot(resample_result, type = &quot;roc&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code>rp_learner = lrn(&quot;classif.rpart&quot;, keep_model = TRUE)
rp_learner$train(sex_task)
autoplot(rp_learner, type = &quot;ggparty&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
