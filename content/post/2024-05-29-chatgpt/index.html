---
title: 机器学习包mlr3和chatGPT
author: Package Build
date: '2024-05-29'
slug: chatgpt
categories:
  - 机器学习
tags:
  - mlr3
---



<p>最近一年发生的事情实在是太多了，chatGPT改变了我们学习的方式。再去做一个知识存储器，已经变得毫无意义。从另外一个角度看，我们已经不需要去记忆。chatGPT就是我们的第二大脑。我们要做的是，如何利用chatGPT来实现自己的想法。创造性、批判性思维是未来衡量一个人是否优秀的重要标准。</p>
<p>看看如何用chatGPT来构建一个机器学习的代码，实现对性别的预测。</p>
<pre class="r"><code>rm(list=ls())
# 安装和加载必要的包
library(mlr3)</code></pre>
<pre><code>## Warning: package &#39;mlr3&#39; was built under R version 4.4.3</code></pre>
<pre class="r"><code>library(mlr3learners)</code></pre>
<pre><code>## Warning: package &#39;mlr3learners&#39; was built under R version 4.4.3</code></pre>
<pre class="r"><code>library(mlr3filters)
library(mlr3tuning)</code></pre>
<pre><code>## Warning: package &#39;mlr3tuning&#39; was built under R version 4.4.3</code></pre>
<pre><code>## Loading required package: paradox</code></pre>
<pre class="r"><code>library(data.table)
library(mlr3verse)</code></pre>
<pre><code>## Warning: package &#39;mlr3verse&#39; was built under R version 4.4.3</code></pre>
<pre class="r"><code>library(mlr3viz)</code></pre>
<pre><code>## Warning: package &#39;mlr3viz&#39; was built under R version 4.4.3</code></pre>
<pre class="r"><code># 读取包括SNP和性别信息的训练文件
sex_snp_dt &lt;- fread(file=&quot;../datasets/BP_55K_SNP_Sex.csv&quot;, sep=&quot;,&quot;,header = TRUE) 


# 创建任务
sex_task &lt;- as_task_classif(sex_snp_dt, target = &quot;Sex&quot;,id=&quot;PreSex&quot;)

# 去除ID列
features_to_keep &lt;- setdiff(sex_task$feature_names, &quot;ID&quot;)

# Select only the desired features
sex_task$select(features_to_keep)

# 创建随机森林学习器，基于Gini指数的减少来衡量变量的重要性
rf_learner &lt;- lrn(&quot;classif.ranger&quot;, predict_type= &quot;prob&quot;, importance = &quot;impurity&quot;, keep.inbag = TRUE, num.trees=100, write.forest = TRUE)

# 查看学习器的参数
rf_learner$param_set</code></pre>
<pre><code>## &lt;ParamSet(28)&gt;
## Key: &lt;id&gt;
##                               id    class lower upper nlevels        default
##                           &lt;char&gt;   &lt;char&gt; &lt;num&gt; &lt;num&gt;   &lt;num&gt;         &lt;list&gt;
##  1:       always.split.variables ParamUty    NA    NA     Inf &lt;NoDefault[0]&gt;
##  2:                class.weights ParamUty    NA    NA     Inf         [NULL]
##  3:                      holdout ParamLgl    NA    NA       2          FALSE
##  4:                   importance ParamFct    NA    NA       4 &lt;NoDefault[0]&gt;
##  5:                   keep.inbag ParamLgl    NA    NA       2          FALSE
##  6:                    max.depth ParamInt     1   Inf     Inf         [NULL]
##  7:                   min.bucket ParamUty    NA    NA     Inf              1
##  8:                min.node.size ParamUty    NA    NA     Inf         [NULL]
##  9:                         mtry ParamInt     1   Inf     Inf &lt;NoDefault[0]&gt;
## 10:                   mtry.ratio ParamDbl     0     1     Inf &lt;NoDefault[0]&gt;
## 11:                    na.action ParamFct    NA    NA       3       na.learn
## 12:                   node.stats ParamLgl    NA    NA       2          FALSE
## 13:            num.random.splits ParamInt     1   Inf     Inf              1
## 14:                  num.threads ParamInt     1   Inf     Inf              1
## 15:                    num.trees ParamInt     1   Inf     Inf            500
## 16:                    oob.error ParamLgl    NA    NA       2           TRUE
## 17:        regularization.factor ParamUty    NA    NA     Inf              1
## 18:      regularization.usedepth ParamLgl    NA    NA       2          FALSE
## 19:                      replace ParamLgl    NA    NA       2           TRUE
## 20:    respect.unordered.factors ParamFct    NA    NA       3 &lt;NoDefault[0]&gt;
## 21:              sample.fraction ParamDbl     0     1     Inf &lt;NoDefault[0]&gt;
## 22:                  save.memory ParamLgl    NA    NA       2          FALSE
## 23: scale.permutation.importance ParamLgl    NA    NA       2          FALSE
## 24:                         seed ParamInt  -Inf   Inf     Inf         [NULL]
## 25:         split.select.weights ParamUty    NA    NA     Inf         [NULL]
## 26:                    splitrule ParamFct    NA    NA       3           gini
## 27:                      verbose ParamLgl    NA    NA       2           TRUE
## 28:                 write.forest ParamLgl    NA    NA       2           TRUE
##                               id    class lower upper nlevels        default
##        parents    value
##         &lt;list&gt;   &lt;list&gt;
##  1:     [NULL]   [NULL]
##  2:     [NULL]   [NULL]
##  3:     [NULL]   [NULL]
##  4:     [NULL] impurity
##  5:     [NULL]     TRUE
##  6:     [NULL]   [NULL]
##  7:     [NULL]   [NULL]
##  8:     [NULL]   [NULL]
##  9:     [NULL]   [NULL]
## 10:     [NULL]   [NULL]
## 11:     [NULL]   [NULL]
## 12:     [NULL]   [NULL]
## 13:  splitrule   [NULL]
## 14:     [NULL]        1
## 15:     [NULL]      100
## 16:     [NULL]   [NULL]
## 17:     [NULL]   [NULL]
## 18:     [NULL]   [NULL]
## 19:     [NULL]   [NULL]
## 20:     [NULL]   [NULL]
## 21:     [NULL]   [NULL]
## 22:     [NULL]   [NULL]
## 23: importance   [NULL]
## 24:     [NULL]   [NULL]
## 25:     [NULL]   [NULL]
## 26:     [NULL]   [NULL]
## 27:     [NULL]   [NULL]
## 28:     [NULL]     TRUE
##        parents    value</code></pre>
<pre class="r"><code># 创建交叉验证
resampling &lt;- rsmp(&quot;cv&quot;, folds = 5)

# 进行交叉验证
resample_result &lt;- resample(sex_task, rf_learner, resampling, store_models = TRUE)</code></pre>
<pre><code>## Warning: package &#39;mlr3fselect&#39; was built under R version 4.4.3</code></pre>
<pre><code>## INFO  [18:57:56.050] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:56.380] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:56.414] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:56.441] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:56.467] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)</code></pre>
<pre class="r"><code># 设置评估参考群数据的预测能力的度量标准
# 准确性
measure_acc &lt;- msr(&quot;classif.acc&quot;)
# 工作特征曲线下面积
measure_auc &lt;- msr(&quot;classif.auc&quot;)

# 打印交叉验证结果
resample_result$aggregate(measure_acc)</code></pre>
<pre><code>## classif.acc 
##   0.9806452</code></pre>
<pre class="r"><code>resample_result$aggregate(measure_auc)</code></pre>
<pre><code>## classif.auc 
##   0.9895788</code></pre>
<pre class="r"><code>autoplot(resample_result,type = &quot;roc&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code># 定义超参数搜索空间
#	1.	mtry：每个树分割节点随机选择的变量数量。
#	•	p_int(1, ncol(data) - 1)：mtry的取值范围是从1到数据集中变量数量减1。
#	2.	min.node.size：树叶节点的最小样本数。
#	•	p_int(1, 10)：min.node.size的取值范围是1到10。
search_space &lt;- ps(
  mtry = p_int(1, length(sex_task$feature_names) - 1),
  min.node.size = p_int(1, 10)
)

# 定义调优实例
tuner &lt;- tnr(&quot;grid_search&quot;, resolution = 10)
instance &lt;- ti(
  task = sex_task,
  learner = rf_learner,
  resampling = resampling,
  measure = measure_acc,
  search_space = search_space,
  terminator = trm(&quot;evals&quot;, n_evals = 20)
)


# 进行超参数调优
tuner$optimize(instance)</code></pre>
<pre><code>## INFO  [18:57:56.819] [bbotk] Starting to optimize 2 parameter(s) with &#39;&lt;OptimizerBatchGridSearch&gt;&#39; and &#39;&lt;TerminatorEvals&gt; [n_evals=20, k=0]&#39;
## INFO  [18:57:56.831] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:56.834] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:56.839] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:56.874] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:56.908] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:56.945] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:56.981] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:57.017] [mlr3] Finished benchmark
## INFO  [18:57:57.031] [bbotk] Result of batch 1:
## INFO  [18:57:57.032] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:57.032] [bbotk]    11            10   0.9806452        0      0            0.156
## INFO  [18:57:57.032] [bbotk]                                 uhash
## INFO  [18:57:57.032] [bbotk]  86dec2b5-d0ba-40a2-835e-aaaa1258545a
## INFO  [18:57:57.033] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:57.036] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:57.041] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:57.066] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:57.094] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:57.120] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:57.145] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:57.170] [mlr3] Finished benchmark
## INFO  [18:57:57.183] [bbotk] Result of batch 2:
## INFO  [18:57:57.184] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:57.184] [bbotk]     3             4   0.9806452        0      0            0.108
## INFO  [18:57:57.184] [bbotk]                                 uhash
## INFO  [18:57:57.184] [bbotk]  7ffe2f94-aad9-4ddd-95b3-c7320c898dc5
## INFO  [18:57:57.185] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:57.188] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:57.192] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:57.231] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:57.268] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:57.312] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:57.352] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:57.392] [mlr3] Finished benchmark
## INFO  [18:57:57.405] [bbotk] Result of batch 3:
## INFO  [18:57:57.406] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:57.406] [bbotk]    16             9   0.9790323        0      0            0.179
## INFO  [18:57:57.406] [bbotk]                                 uhash
## INFO  [18:57:57.406] [bbotk]  fa010b03-9fa9-4388-ac19-071eda4d9e33
## INFO  [18:57:57.407] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:57.410] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:57.414] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:57.438] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:57.463] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:57.495] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:57.520] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:57.545] [mlr3] Finished benchmark
## INFO  [18:57:57.558] [bbotk] Result of batch 4:
## INFO  [18:57:57.559] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:57.559] [bbotk]     3             3   0.9806452        0      0            0.109
## INFO  [18:57:57.559] [bbotk]                                 uhash
## INFO  [18:57:57.559] [bbotk]  069d63c0-3a4b-42c1-9b65-c8ab3c37af9d
## INFO  [18:57:57.560] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:57.563] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:57.567] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:57.607] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:57.644] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:57.689] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:57.730] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:57.771] [mlr3] Finished benchmark
## INFO  [18:57:57.783] [bbotk] Result of batch 5:
## INFO  [18:57:57.785] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:57.785] [bbotk]    16             4   0.9806452        0      0            0.182
## INFO  [18:57:57.785] [bbotk]                                 uhash
## INFO  [18:57:57.785] [bbotk]  380dc308-9088-4c61-b691-9342babb5e95
## INFO  [18:57:57.786] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:57.788] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:57.793] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:57.825] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:57.868] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:57.901] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:57.934] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:57.965] [mlr3] Finished benchmark
## INFO  [18:57:57.978] [bbotk] Result of batch 6:
## INFO  [18:57:57.979] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:57.979] [bbotk]     8             8   0.9806452        0      0            0.151
## INFO  [18:57:57.979] [bbotk]                                 uhash
## INFO  [18:57:57.979] [bbotk]  da5aa5e2-eb27-4f38-a357-329be41830d1
## INFO  [18:57:57.980] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:57.983] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:57.987] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:58.033] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:58.075] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:58.126] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:58.173] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:58.220] [mlr3] Finished benchmark
## INFO  [18:57:58.233] [bbotk] Result of batch 7:
## INFO  [18:57:58.234] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:58.234] [bbotk]    23             7   0.9798387        0      0            0.209
## INFO  [18:57:58.234] [bbotk]                                 uhash
## INFO  [18:57:58.234] [bbotk]  13cc0c2e-ef0d-4df0-b9bf-462dd41c4128
## INFO  [18:57:58.235] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:58.238] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:58.242] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:58.287] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:58.328] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:58.379] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:58.426] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:58.473] [mlr3] Finished benchmark
## INFO  [18:57:58.486] [bbotk] Result of batch 8:
## INFO  [18:57:58.487] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:58.487] [bbotk]    21             2   0.9814516        0      0            0.209
## INFO  [18:57:58.487] [bbotk]                                 uhash
## INFO  [18:57:58.487] [bbotk]  ca9bfeb1-6840-4487-99e3-e1c7e967a922
## INFO  [18:57:58.488] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:58.491] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:58.495] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:58.535] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:58.571] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:58.618] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:58.660] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:58.700] [mlr3] Finished benchmark
## INFO  [18:57:58.713] [bbotk] Result of batch 9:
## INFO  [18:57:58.714] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:58.714] [bbotk]    16             6   0.9806452        0      0            0.182
## INFO  [18:57:58.714] [bbotk]                                 uhash
## INFO  [18:57:58.714] [bbotk]  889402b4-2494-4b75-9578-c2335dfc47ed
## INFO  [18:57:58.715] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:58.718] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:58.722] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:58.769] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:58.927] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:58.977] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:59.024] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:59.073] [mlr3] Finished benchmark
## INFO  [18:57:59.086] [bbotk] Result of batch 10:
## INFO  [18:57:59.087] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:59.087] [bbotk]    23             3   0.9814516        0      0            0.328
## INFO  [18:57:59.087] [bbotk]                                 uhash
## INFO  [18:57:59.087] [bbotk]  cb69cce5-c4e4-4325-a66e-cd52e34b0296
## INFO  [18:57:59.088] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:59.091] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:59.095] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:59.139] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:59.180] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:59.225] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:59.270] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:59.315] [mlr3] Finished benchmark
## INFO  [18:57:59.330] [bbotk] Result of batch 11:
## INFO  [18:57:59.331] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:59.331] [bbotk]    21             7   0.9798387        0      0            0.203
## INFO  [18:57:59.331] [bbotk]                                 uhash
## INFO  [18:57:59.331] [bbotk]  83b6f2bd-fd8e-4b73-93ee-df291a88ed06
## INFO  [18:57:59.332] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:59.335] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:59.340] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:59.374] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:59.412] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:59.446] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:59.479] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:59.511] [mlr3] Finished benchmark
## INFO  [18:57:59.525] [bbotk] Result of batch 12:
## INFO  [18:57:59.526] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:59.526] [bbotk]     8             4   0.9806452        0      0             0.15
## INFO  [18:57:59.526] [bbotk]                                 uhash
## INFO  [18:57:59.526] [bbotk]  f2bb183d-6de5-4407-9c80-598f3ccc2930
## INFO  [18:57:59.527] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:59.530] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:59.534] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:59.581] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:59.623] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:59.672] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:59.720] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:59.767] [mlr3] Finished benchmark
## INFO  [18:57:59.784] [bbotk] Result of batch 13:
## INFO  [18:57:59.785] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:59.785] [bbotk]    23             5   0.9798387        0      0             0.21
## INFO  [18:57:59.785] [bbotk]                                 uhash
## INFO  [18:57:59.785] [bbotk]  add593f7-6449-422e-a1d2-1615fc9d857b
## INFO  [18:57:59.786] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:59.789] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:59.793] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:57:59.825] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:57:59.855] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:57:59.889] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:57:59.922] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:57:59.954] [mlr3] Finished benchmark
## INFO  [18:57:59.967] [bbotk] Result of batch 14:
## INFO  [18:57:59.968] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:57:59.968] [bbotk]     8             2   0.9806452        0      0            0.142
## INFO  [18:57:59.968] [bbotk]                                 uhash
## INFO  [18:57:59.968] [bbotk]  87568d10-e67e-451b-ade8-f4a75dfe4ed6
## INFO  [18:57:59.970] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:57:59.972] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:57:59.976] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:58:00.005] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:58:00.034] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:58:00.065] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:58:00.100] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:58:00.129] [mlr3] Finished benchmark
## INFO  [18:58:00.142] [bbotk] Result of batch 15:
## INFO  [18:58:00.143] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:58:00.143] [bbotk]     6             4   0.9806452        0      0            0.132
## INFO  [18:58:00.143] [bbotk]                                 uhash
## INFO  [18:58:00.143] [bbotk]  6b799549-91cd-4e7c-b6a5-97e931e2cfb1
## INFO  [18:58:00.144] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:58:00.147] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:58:00.151] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:58:00.172] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:58:00.191] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:58:00.211] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:58:00.231] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:58:00.250] [mlr3] Finished benchmark
## INFO  [18:58:00.263] [bbotk] Result of batch 16:
## INFO  [18:58:00.264] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:58:00.264] [bbotk]     1             6   0.9806452        0      0             0.08
## INFO  [18:58:00.264] [bbotk]                                 uhash
## INFO  [18:58:00.264] [bbotk]  10bfde2a-99aa-44f7-af1a-e3ed414b7894
## INFO  [18:58:00.265] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:58:00.268] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:58:00.272] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:58:00.292] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:58:00.316] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:58:00.337] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:58:00.356] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:58:00.375] [mlr3] Finished benchmark
## INFO  [18:58:00.388] [bbotk] Result of batch 17:
## INFO  [18:58:00.389] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:58:00.389] [bbotk]     1             2   0.9806452        0      0            0.081
## INFO  [18:58:00.389] [bbotk]                                 uhash
## INFO  [18:58:00.389] [bbotk]  ed88c50a-13fd-4bd5-8c7c-1d9aacd82d52
## INFO  [18:58:00.390] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:58:00.393] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:58:00.397] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:58:00.429] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:58:00.459] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:58:00.492] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:58:00.524] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:58:00.560] [mlr3] Finished benchmark
## INFO  [18:58:00.574] [bbotk] Result of batch 18:
## INFO  [18:58:00.575] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:58:00.575] [bbotk]     8             6   0.9806452        0      0            0.145
## INFO  [18:58:00.575] [bbotk]                                 uhash
## INFO  [18:58:00.575] [bbotk]  2622e0c1-87dc-4e1a-bd22-7ce5daba4d55
## INFO  [18:58:00.577] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:58:00.579] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:58:00.584] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:58:00.620] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:58:00.653] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:58:00.690] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:58:00.726] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:58:00.760] [mlr3] Finished benchmark
## INFO  [18:58:00.774] [bbotk] Result of batch 19:
## INFO  [18:58:00.775] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:58:00.775] [bbotk]    11             7   0.9806452        0      0            0.154
## INFO  [18:58:00.775] [bbotk]                                 uhash
## INFO  [18:58:00.775] [bbotk]  401e0f80-3ee2-4b65-8758-46c234ef4853
## INFO  [18:58:00.776] [bbotk] Evaluating 1 configuration(s)
## INFO  [18:58:00.779] [mlr3] Running benchmark with 5 resampling iterations
## INFO  [18:58:00.784] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 1/5)
## INFO  [18:58:00.834] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 2/5)
## INFO  [18:58:00.875] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 3/5)
## INFO  [18:58:00.922] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 4/5)
## INFO  [18:58:00.969] [mlr3] Applying learner &#39;classif.ranger&#39; on task &#39;PreSex&#39; (iter 5/5)
## INFO  [18:58:01.014] [mlr3] Finished benchmark
## INFO  [18:58:01.027] [bbotk] Result of batch 20:
## INFO  [18:58:01.028] [bbotk]  mtry min.node.size classif.acc warnings errors runtime_learners
## INFO  [18:58:01.028] [bbotk]    21             3   0.9806452        0      0            0.205
## INFO  [18:58:01.028] [bbotk]                                 uhash
## INFO  [18:58:01.028] [bbotk]  12b8b33c-7779-4959-95da-ff8d2b0037d2
## INFO  [18:58:01.035] [bbotk] Finished optimizing after 20 evaluation(s)
## INFO  [18:58:01.035] [bbotk] Result:
## INFO  [18:58:01.036] [bbotk]   mtry min.node.size learner_param_vals  x_domain classif.acc
## INFO  [18:58:01.036] [bbotk]  &lt;int&gt;         &lt;int&gt;             &lt;list&gt;    &lt;list&gt;       &lt;num&gt;
## INFO  [18:58:01.036] [bbotk]     21             2          &lt;list[7]&gt; &lt;list[2]&gt;   0.9814516</code></pre>
<pre><code>##     mtry min.node.size learner_param_vals  x_domain classif.acc
##    &lt;int&gt;         &lt;int&gt;             &lt;list&gt;    &lt;list&gt;       &lt;num&gt;
## 1:    21             2          &lt;list[7]&gt; &lt;list[2]&gt;   0.9814516</code></pre>
<pre class="r"><code># 获取最佳参数
best_params &lt;- instance$result_learner_param_vals
print(best_params)</code></pre>
<pre><code>## $importance
## [1] &quot;impurity&quot;
## 
## $keep.inbag
## [1] TRUE
## 
## $num.threads
## [1] 1
## 
## $num.trees
## [1] 100
## 
## $write.forest
## [1] TRUE
## 
## $mtry
## [1] 21
## 
## $min.node.size
## [1] 2</code></pre>
<pre class="r"><code># 使用最佳参数训练模型
rf_learner$param_set$values &lt;- best_params
rf_learner$train(sex_task)

# 获取特征重要性
importance &lt;- as.data.table(rf_learner$importance(), keep.rownames = TRUE)
setnames(importance, c(&quot;Feature&quot;, &quot;Importance&quot;))

# 打印变量重要性
print(importance)</code></pre>
<pre><code>##                    Feature   Importance
##                     &lt;char&gt;        &lt;num&gt;
##  1:  NW_020869892.1_791056 3.886904e+02
##  2:   NW_020870605.1_27103 9.229741e+01
##  3: NW_020870091.1_1375545 6.841212e+01
##  4:    NW_020871184.1_1572 1.155576e+01
##  5:  NW_020872449.1_998527 1.128476e+01
##  6:  NW_020868494.1_348609 3.552605e+00
##  7: NW_020872622.1_1032359 3.341382e+00
##  8:   NW_020870605.1_26371 2.952196e+00
##  9:   NW_020869050.1_77499 2.845765e+00
## 10:  NW_020872535.1_937428 2.550365e+00
## 11:  NW_020870721.1_658002 1.993497e+00
## 12:  NW_020871094.1_359648 1.886267e+00
## 13:   NW_020872396.1_14640 1.802184e+00
## 14:   NW_020870023.1_44774 1.431756e+00
## 15:  NW_020870605.1_296954 1.137045e+00
## 16:  NW_020869886.1_223326 3.991850e-02
## 17:   NW_020872461.1_91390 1.865588e-02
## 18:  NW_020871839.1_399752 1.123810e-02
## 19:  NW_020869892.1_778639 3.333333e-03
## 20:  NW_020871839.1_399750 6.666667e-04
## 21:  NW_020868464.1_423800 0.000000e+00
## 22:   NW_020870770.1_46798 0.000000e+00
## 23:   NW_020870770.1_64668 0.000000e+00
## 24:  NW_020870787.1_121276 0.000000e+00
##                    Feature   Importance</code></pre>
<p>可视化随机森林的结果</p>
<pre class="r"><code>library(ggparty)</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Loading required package: partykit</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: libcoin</code></pre>
<pre><code>## Loading required package: mvtnorm</code></pre>
<pre class="r"><code># 获取随机森林模型中的所有树

autoplot(sex_task)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code># ROC curve for resample result
autoplot(resample_result, type = &quot;roc&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code>rp_learner = lrn(&quot;classif.rpart&quot;, keep_model = TRUE)
rp_learner$train(sex_task)
autoplot(rp_learner, type = &quot;ggparty&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
