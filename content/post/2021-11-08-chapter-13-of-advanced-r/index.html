---
title: 高级R编程 第13章 非标准计算
author: Sheng Luan
date: '2021-11-08'
slug: chapter-13-of-advanced-r
categories:
  - 编程
tags:
  - substitute
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>先来看一个R plot绘制的图：</p>
<pre class="r"><code>x &lt;- seq(0,2*pi,length=100)
sinx &lt;- sin(x)
plot(x,sinx,type=&quot;l&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/plot-1.png" width="672" />
从图中可以看出，plot函数自动把x和y轴的标题设置为两个变量的名字：x和sinx。在大部分编程语言中，我们<strong>只可以访问函数参数x和sinx的值</strong>，而<strong>不是参数自身</strong>。在R中，这种对函数参数进行计算的方式，称为<strong>非标准计算，简称为NSE</strong>。</p>
<div id="表达式获取" class="section level2">
<h2>13.1 表达式获取</h2>
<p>Base R中的substitue()函数用来实现非标准计算。它用来查找函数参数，但并不关心函数参数的值。</p>
<pre class="r"><code>f &lt;- function(x) {
  substitute(x)
}
f(1:10)</code></pre>
<pre><code>## 1:10</code></pre>
<pre class="r"><code>x &lt;- 10
f(x)</code></pre>
<pre><code>## x</code></pre>
<pre class="r"><code>y &lt;- 13
f(x+y^2)</code></pre>
<pre><code>## x + y^2</code></pre>
<p>substitute()返回的是表达式类型。该函数的参数使用了一种特殊的类型，<strong>约定（promise）</strong>。该类型捕获用来计算的表达式和执行该表达式的环境。</p>
<p>substitute()和deparse()经常会搭配使用。deparse()以substitute()的返回结果（表达式）为参数，输出一个<strong>字符向量</strong>。</p>
<pre class="r"><code>g &lt;- function(x) deparse(substitute(x))
g(1:10)</code></pre>
<pre><code>## [1] &quot;1:10&quot;</code></pre>
<pre class="r"><code>g(x)</code></pre>
<pre><code>## [1] &quot;x&quot;</code></pre>
<pre class="r"><code>g(x+y^2)</code></pre>
<pre><code>## [1] &quot;x + y^2&quot;</code></pre>
<p>上述函数组合的一个用法，譬如在加载包时，可以不用输入双引号。</p>
<pre class="r"><code>library(data.table)
library(&quot;data.table&quot;)</code></pre>
<p>其他函数，例如plot.default()，使用上述函数来提供默认的标签。</p>
<p>data.frame函数使用上述函数来记录整合进数据框的变量的名称。</p>
<pre class="r"><code>x &lt;- 1:4
y &lt;- letters[1:4]
names(data.frame(x,y))</code></pre>
<pre><code>## [1] &quot;x&quot; &quot;y&quot;</code></pre>
<div id="练习" class="section level3">
<h3>练习</h3>
<pre class="r"><code>g(a+b+c+d+e+f+g+h)</code></pre>
<pre><code>## [1] &quot;a + b + c + d + e + f + g + h&quot;</code></pre>
</div>
</div>
